<ng-container *ngIf="loadingFlag; then loading; else notLoading"></ng-container>
<ng-template #loading>
    <div style="text-align:center" class="mt-5">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
</ng-template>
<ng-template #notLoading>
    <ng-container *ngIf="localProfileFlag; then displayProfile; else editProfile"></ng-container>
    <ng-template #displayProfile>
        <div class="mx-4 fs-3">
            <div class="row mb-3">
                <div class="col-3 ">
                    <div class="me-3"><b>ชื่อ:</b></div>
                </div>
                <div class="col">
                    <div class="me-3">{{innerProfileInformation.name}}</div>
                </div>
                <div class="d-flex col flex-row-reverse">
                    <div class="form-check form-switch">
                        <input class="form-check-input" [(ngModel)]="showSwitch" (change)="switchShowProfile($event)" type="checkbox" id="flexSwitchCheckDefault" >
                        <label class="form-check-label" for="flexSwitchCheckDefault">เปิดเผยข้อมูล</label>
                    </div>
                    <div *ngIf="showSwitchLoadingFlag" class="spinner-border text-primary me-3" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-3">
                    <div class="me-3"><b>นามสกุล:</b></div>
                </div>
                <div class="col">
                    <div class="me-3">{{innerProfileInformation.surname}}</div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-3">
                    <div class="me-3"><b>เพศ:</b></div>
                </div>
                <div class="col-3">
                    <div class="me-3">{{innerProfileInformation.gender}}</div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-3">
                    <div class="me-3"><b>วันเกิด:</b></div>
                </div>
                <div class="col">
                    <div class="me-3">{{innerProfileInformation.birthday}}</div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-3">
                    <div class="me-3"><b>อายุ:</b></div>
                </div>
                <div class="col">
                    <div class="me-3">{{innerProfileInformation.age}}</div>
                </div>
            </div>
            <div class="row">
                <div class="col-3">
                    <div><b>ที่อยู่:</b></div>
                </div>
                <div class="col">
                    <div class="row mb-3">
                        <div class="col">
                            {{innerProfileInformation.Location?.address}}
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-2">
                            <div><b>แขวง:</b></div>
                        </div>
                        <div class="col d-flex flex-row">
                            <div class="">{{innerProfileInformation.Location?.Section}}</div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-2">
                            <div><b>เขต:</b></div>
                        </div>
                        <div class="col d-flex flex-row">
                            <div class="">{{innerProfileInformation.Location?.District}}</div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-2">
                            <div><b>จังหวัด:</b></div>
                        </div>
                        <div class="col d-flex flex-row">
                            <div class="">{{innerProfileInformation.Location?.Province}}</div>                    
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-2">
                    <div><b>ปักหมุด:</b></div>
                </div>
                <div class="col">
                    <div class="mt-3 me-3"></div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-3">
                    <div class="me-3"><b>ระดับการศึกษา:</b></div>
                </div>
                <div class="col">
                    <div class="me-3">{{innerProfileInformation.educationLevel}}</div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-3">
                    <div class="me-3"><b>ข้อมูลการติดต่อ:</b></div>
                </div>
                <div class="col">
                    <div class="row mb-3">
                        <div class="col-2">
                            <div><b>เบอร์โทร:</b></div>
                        </div>
                        <div class="col">
                            <div class="me-3">{{innerProfileInformation.contacts?.phone}}</div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-2">
                            <div><b>Email:</b></div>
                        </div>
                        <div class="col">
                            <div class="me-3">{{innerProfileInformation.contacts?.email}}</div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-2">
                            <div><b>LINE:</b></div>
                        </div>
                        <div class="col">
                            <div class="me-3">{{innerProfileInformation.contacts?.line}}</div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-2">
                            <div><b>Facebook:</b></div>
                        </div>
                        <div class="col">
                            <div class="me-3">{{innerProfileInformation.contacts?.facebook}}</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-3">
                    <div class="me-3"><b>เลขที่ใบประกอบ ภ:</b></div>
                </div>
                <div class="col">
                    <div class="me-3">{{innerProfileInformation.license}}</div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-3">
                    <div class="me-3"><b>ประวัติการศึกษา:</b></div>
                </div>
                <div class="col">
                    <div *ngFor="let eduGroup of innerProfileInformation.educationHistory">
                        <div class="row mb-3">
                            <div class="col-2"><b>ชื่อสถาบัน:</b></div>
                            <div class="col">{{eduGroup.universityName}}:</div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-2"><b>สาขา:</b></div>
                            <div class="col">{{eduGroup.franchise}}:</div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-2"><b>ปีที่จบ:</b></div>
                            <div class="col">{{eduGroup.yearGraduated}}:</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-3">
                    <div class="me-3"><b>ประสบการณ์งาน:</b></div>
                </div>
                <div class="col">
                    {{ WorkExperience }}
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-3">
                    <div class="me-3"><b>ประวัติการทำงาน:</b></div>
                </div>
                <div class="col">
                    <div *ngFor="let jobGroup of innerProfileInformation.jobHistory">
                        <div class="row mb-3">
                            <div class="col-2"><b>ตำแหน่ง:</b></div>
                            <div class="col">{{jobGroup.jobName}}:</div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-2"><b>ชื่อบริษัท:</b></div>
                            <div class="col">{{jobGroup.companyName}}</div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-2"><b>ระยะเวลา:</b></div>
                            <div class="col">
                                <div class="row mb-3">
                                    <div class="col-3"><b>วันที่เริ่มต้น:</b></div>
                                    <div class="col">{{jobGroup.dateStarted}}</div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-3"><b>วันที่สิ้นสุด:</b></div>
                                    <div class="col">{{jobGroup.dateEnded}}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row my-5">
                <div class="col my-5" style="text-align:center"><b>งานที่กำลังมองหาหรือสนใจ</b></div>
            </div>
            <div class="row mb-3">
                <div class="col-3">
                    <div class="me-3"><b>ประเภทงานที่สนใจ:</b></div>
                </div>
                <div class="col">
                    <div *ngFor="let jobType of resultPayload">
                        {{jobType}}
                    </div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-3">
                    <div class="me-3"><b>ชนิดของงานที่สนใจ:</b></div>
                </div>
                <div class="col">
                        {{innerProfileInformation.preferredTimeFrame}}
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-3">
                    <div><b>หางานพื้นที่ :</b></div>
                </div>
                <div class="col">
                    <div class="row mb-3">
                        <div class="col-2">
                            <div><b>แขวง:</b></div>
                        </div>
                        <div class="col d-flex flex-row">
                            <div class="">{{innerProfileInformation.preferredLocation?.Section}}</div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-2">
                            <div><b>เขต:</b></div>
                        </div>
                        <div class="col d-flex flex-row">
                            <div class="">{{innerProfileInformation.preferredLocation?.District}}</div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-2">
                            <div><b>จังหวัด:</b></div>
                        </div>
                        <div class="col d-flex flex-row">
                            <div class="">{{innerProfileInformation.preferredLocation?.Province}}</div>                    
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-3">
                    <div class="me-3"><b>เงินเดือนที่ต้องการ:</b></div>
                </div>
                <div class="col">
                        {{innerProfileInformation.preferredStartTime}}
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-3">
                    <div class="me-3"><b>สามารถเริ่มงานได้ :</b></div>
                </div>
                <div class="col">
                        {{innerProfileInformation.preferredSalary}}
                </div>
            </div>
        </div>
    </ng-template>
    <ng-template #editProfile>
        <div class="mx-4">
            <div class="my-5 h1"><b>ตัดต่อ</b></div>
            <form [formGroup]="profileEdit" (ngSubmit)="onSave()">
                <div class="fs-3 my-3">
                    <div class="row">
                        <div class="col-3">
                            <label for="name" class="form-label">
                                <b>ชื่อ:</b>
                            </label>
                        </div>
                        <div class="col-7">
                            <input formControlName="name" type="text" style="width:-fill-webkit-available" class="form-control me-3">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-3">
                            <label for="surname" class="form-label"><b>นามสกุล:</b></label>
                        </div>
                        <div class="col-7">
                            <input formControlName="surname" type="text" class="form-control me-3">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-3">
                            <label for="gender" class="form-label"><b>เพศ:</b></label>
                        </div>
                        <div class="col-7">
                            <select formControlName="gender" class="form-select mb-3" aria-label="Default select example">
                                <option selected value="ชาย">ชาย</option>
                                <option value="หญิง">หญิง</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-3">
                            <label for="birthday" class="form-label"><b>วันเกิด:</b></label>
                        </div>
                        <div class="col-7">
                            <input formControlName="birthday" type="date" style="width:fit-content "class="mb-3 form-control">
                        </div>
                    </div>
                    <app-location [parentFormGroup]="profileEdit"></app-location>
                    <div>
                        <div class="row">
                            <label for="googleLocation" class="col-3 mb-3 form-label"><b>ปักหมุด:</b></label>
                            <div class="col-7">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-3">
                            <label for="educationLevel" class="me-3 form-label"><b>ระดับการศึกษา:</b></label>
                        </div>
                        <div class="col-7">
                            <select formControlName="educationLevel" class="form-select mb-3" aria-label="Default select example">
                                <option selected value="ปริญญาตรี">ปริญญาตรี</option>
                                <option value="ปริญญาโท">ปริญญาโท</option>
                                <option value="ปริญญาโท">ปริญญาเอก</option>
                            </select>
                        </div>
                    </div>
                    <div class="my-3" formGroupName="contacts">
                        <label class="me-3 form-label"><b>ข้อมูลการติดต่อ:</b></label>
                        <div class="row">
                            <div class="col-3">
                                <label for="phone" class="form-label ms-3">เบอร์โทร:</label>
                            </div>
                            <div class="col-7">
                                <input formControlName="phone" type="text" class="form-control">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-3">
                                <label for="email" class="form-label ms-3">Email:</label>
                            </div>
                            <div class="col-7">
                                <input formControlName="email" type="text" class="form-control">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-3">
                                <label for="line" class="form-label ms-3">LINE:</label>
                            </div>
                            <div class="col-7">
                                <input formControlName="line" type="text" class="form-control">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-3">
                                <label for="facebook" class="form-label ms-3">Facebook:</label>
                            </div>
                            <div class="col-7">
                                <input formControlName="facebook" type="text" class="form-control">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-3">
                            <label for="license" class="form-label"><b>เลขที่ใบประกอบ ภ:</b></label>
                        </div>
                        <div class="col-7">
                            <input formControlName="license" type="text" class="form-control">
                        </div>
                    </div>
                    <ng-container formArrayName="educationHistory" >
                        <ng-container *ngFor="let number of FormEduData let i = index" [formGroupName] = "i">
                            <div class="row">
                                <div class="col-3">
                                    <label *ngIf='i == 0' class="form-label"><b>ประวัติการศึกษา: </b></label>
                                </div>
                                <div class="col-6 mb-3">
                                    <div class="row">
                                        <div class="col-4">
                                            <label for="universityName" class="form-label"><b>ชื่อสถาบัน:</b></label>
                                        </div>
                                        <div class="col">
                                            <input formControlName="universityName" type="text" class="form-control me-3">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-4">
                                            <label for="franchise" class="form-label"><b>สาขา:</b></label>
                                        </div>
                                        <div class="col">
                                            <input formControlName="franchise" type="text" class="form-control">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-4 mb-3">
                                            <label for="yearGraduated" class="form-label"><b>ปีที่จบ:</b></label>
                                        </div>
                                        <div class="col">
                                            <input formControlName="yearGraduated" type="text" class="form-control">
                                        </div>
                                    </div>
                                </div>
                                <div class="col">
                                    <ng-container *ngIf="i == 0; then add; else noadd"></ng-container>
                                    <ng-template #add>
                                        <i (click)="addEducation()" class="button bi bi-plus-circle-fill"></i>
                                    </ng-template>
                                    <ng-template #noadd>
                                        <i style="visibility:hidden" class="button bi bi-plus-circle-fill"></i>
                                    </ng-template>
                                    <i type="button" (click)="removeEducation(i)"  *ngIf='i !== 0' class=" ms-3 button bi bi-trash-fill"></i>
                                </div>
                            </div>
                        </ng-container>
                    </ng-container>
                    <div class="row mb-3">
                        <div class="col-3">
                            <div class="me-3"><b>ประสบการณ์งาน:</b></div>
                        </div>
                        <div class="col">
                            {{ WorkExperience }}
                        </div>
                    </div>
                    <ng-container formArrayName="jobHistory">
                        <ng-container [formGroupName]="i" *ngFor="let number of FormJobData; let i = index">
                            <div class="row">
                                <div class="col-3">
                                    <label *ngIf='i == 0' class="form-label"><b>ประวัติการทำงาน:</b></label>
                                </div>
                                <div class="col-6">
                                    <div class="row">
                                        <div class="col-4">
                                            <label for="jobName" class="form-label"><b>ตำแหน่ง:</b></label>
                                        </div>
                                        <div class="col">
                                            <input formControlName="jobName" type="text" class="form-control">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-4">
                                            <label for="companyName" class="form-label"><b>ชื่อบริษัท:</b></label>
                                        </div>
                                        <div class="col">
                                            <input formControlName="companyName" type="text" class="form-control">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-4">
                                            <label class="form-label"><b>ระยะเวลา:</b></label>
                                        </div>
                                        <div class="col">
                                            <label for="dateStarted" class="form-label ">วันที่เริ่มต้น:</label>
                                            <ng-container *ngIf="i > 0; then secondDate; else firstDate"></ng-container>
                                            <ng-template #secondDate>
                                                <input formControlName="dateStarted" [min]="dateEnded(i-1)" [max]="dateEnded(i)" type="date" class="form-control mb-3">
                                            </ng-template>
                                            <ng-template #firstDate>
                                                <input formControlName="dateStarted" [max]="dateEnded(i)" type="date" class="form-control mb-3">
                                            </ng-template>
                                            <label for="dateEnded" class="form-label">วันที่สิ้นสุด:</label>
                                            <input formControlName="dateEnded" [min]="dateStarted(i)"  type="date" class="form-control mb-3">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-4">
                                            <label for="description" class="mb-3 form-label"><b>อธิบายงาน:</b></label>
                                        </div>
                                        <div class="col">
                                            <div class="mb-3">
                                                <textarea formControlName="description" class="form-control" row="10"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <div class="col-1">
                                        <div class="d-flex flex-start">
                                            <ng-container *ngIf="i == 0; then addOccupations; else noaddOccupations"></ng-container>
                                            <ng-template #addOccupations>
                                                <i (click)="addOccupation()"class="button bi bi-plus-circle-fill"></i>
                                            </ng-template>
                                            <ng-template #noaddOccupations>
                                                <i style="visibility:hidden" class="button bi bi-plus-circle-fill"></i>
                                            </ng-template>
                                            <i (click)="removeOccupation(i)"  *ngIf='i !== 0' class=" ms-3 button bi bi-trash-fill"></i>
                                        </div>
                                    </div>
                                    <div class="col form-check">
                                        <input class="form-check-input" type="radio" name="activeFlag" formControlName="activeFlag" (change)="changeDetected($event, i)">
                                        <label for="active" class="text-center fs-5 form-check-label">
                                            ยังอยู่ในตำแหน่งนี้
                                        </label>
                                    </div>
                            </div>
                        </ng-container>
                    </ng-container>
                    <div class="row my-5">
                        <div class="col my-5" style="text-align:center"><b>งานที่กำลังมองหาหรือสนใจ</b></div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-3">
                            <div class="me-3"><b>ประเภทงานที่สนใจ:</b></div>
                        </div>
                        <div class="col" formGroupName="preferredJobType">
                            <div class="row row-cols-2">
                                <div class="d-flex flex-row-start mb-3">
                                    <input formControlName="S" class="me-3 form-check-input" type="checkbox" value="" id="S">
                                    <label class="form-check-label" for="S">
                                        งานด่วนรายวัน
                                    </label>
                                </div>
                                <div class="d-flex flex-row-start mb-3">
                                    <input formControlName="AA" class="me-3 form-check-input" type="checkbox" value="" id="AA">
                                    <label class="form-check-label" for="AA">
                                        งานร้านยาทั่วไป
                                    </label>
                                </div>
                                <div class="d-flex flex-row-start mb-3">
                                    <input formControlName="AB" class="me-3 form-check-input" type="checkbox" value="" id="AB">
                                    <label class="form-check-label" for="AB">
                                        งานร้านยา Brand
                                    </label>
                                </div>
                                <div class="d-flex flex-row-start mb-3">
                                    <input formControlName="AC" class="me-3 form-check-input" type="checkbox" value="" id="AC">
                                    <label class="form-check-label" for="AC">
                                        งานโรงพยาบาล
                                    </label>
                                </div>
                                <div class="d-flex flex-row-start mb-3">
                                    <input formControlName="BA" class="me-3 form-check-input" type="checkbox" value="" id="BA">
                                    <label class="form-check-label" for="BA">
                                        งานคลินิก
                                    </label>
                                </div>
                                <div class="d-flex flex-row-start mb-3">
                                    <input formControlName="BB" class="me-3 form-check-input" type="checkbox" value="" id="BB">
                                    <label class="form-check-label" for="BB">
                                        งานโรงงาน
                                    </label>
                                </div>
                                <div class="d-flex flex-row-start mb-3">
                                    <input formControlName="BC" class="me-3 form-check-input" type="checkbox" value="" id="BC">
                                    <label class="form-check-label" for="BC">
                                        งานบริษัท
                                    </label>
                                </div>
                                <div class="d-flex flex-row-start mb-3">
                                    <input formControlName="CA" class="me-3 form-check-input" type="checkbox" value="" id="CA">
                                    <label class="form-check-label" for="CA">
                                        งานวิจัย
                                    </label>
                                </div>
                                <div class="d-flex flex-row-start mb-3">
                                    <input formControlName="CB" class="me-3 form-check-input" type="checkbox" value="" id="CB">
                                    <label class="form-check-label" for="CB">
                                        งานอื่นๆ
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-3">
                            <div class="me-3"><b>ชนิดของงานที่สนใจ:</b></div>
                        </div>
                        <div class="col">
                            <select formControlName="preferredTimeFrame" name="preferredTimeFrame" class="form-select mb-3">
                                <option selected value="Full-Time">Full-Time</option>
                                <option value="Part-Time">Part-Time</option>
                            </select>
                        </div>
                    </div>
                    <app-location [parentFormGroup]="profileEdit" [formGroupName]="'preferredLocation'"></app-location>
                    <div class="row mb-3">
                        <div class="col-3">
                            <div class="me-3"><b>เงินเดือนที่ต้องการ:</b></div>
                        </div>
                        <div class="col">
                            <select formControlName="preferredSalary" name="preferredSalary" class="form-select mb-3">
                                <option selected value="20,000">20,000</option>
                                <option selected value="30,000">30,000</option>
                                <option selected value="40,000">40,000</option>
                                <option selected value="50,000">50,000</option>
                                <option selected value="60,000">60,000</option>
                                <option selected value="70,000">70,000</option>
                                <option selected value="80,000">80,000</option>
                                <option selected value="90,000">90,000</option>
                                <option selected value="100,000+">100,000+</option>
                            </select>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-3">
                            <div class="me-3"><b>สามารถเริ่มงานได้ :</b></div>
                        </div>
                        <div class="col">
                            <select formControlName="preferredStartTime" name="preferredStartTime" class="form-select mb-3">
                                <option selected value="ทันที">ทันที</option>
                                <option selected value="ภายใน 1 สัปดาห์">ภายใน 1 สัปดาห์</option>
                                <option selected value="ภายใน 2 สัปดาห์">ภายใน 2 สัปดาห์</option>
                                <option selected value="ภายใน 3 สัปดาห์">ภายใน 3 สัปดาห์</option>
                                <option selected value="ภายใน 1 เดือน">ภายใน 1 เดือน</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="d-flex justify-content-center">
                    <button class="btn btn-success fs-2 my-5" type="submit">SAVE</button>
                </div>
            </form>
        </div>
    </ng-template>
</ng-template>
<div class="modal fade" id="saveModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Save Changes?</h4>
                <button type="button" class="btn btn-white close" aria-label="Close" (click)="cancelEventClick()">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Do you want to save your changes before exit?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" (click)="discardClick()">Discard</button>
                <button type="button" class="btn btn-success" (click)="onSave()">Save</button>
            </div>
        </div>
    </div>
</div>
